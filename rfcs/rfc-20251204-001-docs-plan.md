# RFC: Developer Documentation for Stave

**RFC ID:** rfc-20251204-001-docs-plan  
**Status:** Implemented  
**Author:** Documentation Team  
**Created:** 2024-12-04  
**Implemented:** 2024-12-04

## Summary

This RFC proposed a documentation structure for Stave covering end-user documentation and contributor documentation.

## Motivation

Stave is a fork of `mage` with additional features. Documentation is required to:

1. Help new users get started
2. Provide guides for advanced usage
3. Document the API
4. Enable contributors to understand the codebase

## Implemented Structure

```text
docs/
├── index.md                      # Landing page with navigation
├── getting-started/
│   ├── installation.md           # Install methods
│   ├── quickstart.md             # First stavefile
│   └── migration-from-mage.md    # Mage users guide
├── user-guide/
│   ├── stavefiles.md             # File conventions and build tags
│   ├── targets.md                # Target functions
│   ├── dependencies.md           # st.Deps and variants
│   ├── namespaces.md             # st.Namespace grouping
│   ├── arguments.md              # Typed target arguments
│   ├── configuration.md          # XDG config, env vars
│   ├── shell-commands.md         # pkg/sh usage
│   ├── file-targets.md           # pkg/target for incremental builds
│   └── advanced.md               # Cross-compile, dry-run, CI, debugging
├── api-reference/
│   ├── cli.md                    # CLI flags and subcommands
│   ├── st.md                     # pkg/st API
│   ├── sh.md                     # pkg/sh API
│   └── target.md                 # pkg/target API
└── contributing/
    ├── development.md            # Dev setup and workflow
    └── architecture.md           # Codebase structure with mermaid diagrams
```

## Design Decisions

### Consolidated Structure

The original proposal included separate files for aliases, imports, and individual advanced topics. The implementation consolidated these:

- Aliases and imports are documented in `targets.md`
- Advanced topics (cross-compilation, dry-run, CI, debugging) are consolidated in `advanced.md`
- API reference uses one file per package rather than one file per function group

This reduces navigation overhead while maintaining coverage.

### Plain Markdown

Documentation uses plain Markdown files renderable on GitHub. No static site generator is required. This decision aligns with the recommendation in the original RFC.

### Cross-Linking

Each page includes:

- Header breadcrumb navigation
- "See Also" footer with related pages
- Inline links to referenced concepts

### Mermaid Diagrams

Architecture documentation uses mermaid diagrams:

- `graph TD` for the overview diagram showing compilation and execution phases
- `stateDiagram-v2` for data flow diagrams

### Style

Documentation follows a terse, academic tone:

- One-sentence definitions to open sections
- Minimal, runnable code examples
- Godoc-style function signatures in API reference
- No hyperbole or marketing language

## Content Summary

### Getting Started (3 files)

- **installation.md**: go install, bootstrap, version verification
- **quickstart.md**: First stavefile, st.Deps, Default target
- **migration-from-mage.md**: Renaming, import changes, feature comparison table

### User Guide (9 files)

- **stavefiles.md**: Build tags, package declaration, stavefiles/ directory
- **targets.md**: Signatures, Default, Aliases, stave:import
- **dependencies.md**: Deps, SerialDeps, CtxDeps, st.F()
- **namespaces.md**: st.Namespace type, namespaced targets
- **arguments.md**: Supported types, positional args, st.F() with args
- **configuration.md**: XDG paths, config files, env vars, stave config subcommands
- **shell-commands.md**: Run, Output, Exec, command factories, helpers
- **file-targets.md**: Path, Glob, Dir, incremental builds
- **advanced.md**: Cross-compilation, dry-run, CI integration, debugging

### API Reference (4 files)

- **cli.md**: All flags, subcommands, exit codes
- **st.md**: Deps, F, Fatal, runtime queries, Namespace
- **sh.md**: Run variants, Output, Exec, Rm, Copy
- **target.md**: Path, Glob, Dir, time-based variants

### Contributing (2 files)

- **development.md**: Prerequisites, bootstrap, common tasks, commit conventions
- **architecture.md**: Package structure, data flow diagrams, caching, error handling

## Deviations from Original Proposal

| Original Proposal                     | Implementation             | Rationale                                     |
| ------------------------------------- | -------------------------- | --------------------------------------------- |
| Separate aliases.md, imports.md       | Merged into targets.md     | Related concepts; reduces file count          |
| Separate advanced/\*.md files         | Single advanced.md         | Topics are interrelated                       |
| Separate API files per function group | One file per package       | Sufficient granularity                        |
| contributing/code-style.md            | Merged into development.md | Concise coverage adequate                     |
| contributing/testing.md               | Merged into development.md | Test commands documented with other tasks     |
| contributing/pull-requests.md         | Merged into development.md | PR workflow fits development guide            |
| contributing/releasing.md             | Omitted                    | Internal process; not needed for contributors |
| changelog.md link                     | Omitted                    | CHANGELOG.md exists at repo root              |

## Open Questions Resolved

1. **Separate docs site?** No. Plain Markdown on GitHub is sufficient for now.
2. **Auto-generated API reference?** No. Hand-written docs provide better examples and context.
3. **Mage compatibility level?** Migration guide covers the essentials.
4. **Video tutorials?** No. Text documentation is the priority.

## References

- [Mage Documentation](https://magefile.org/)
- [Go Documentation Best Practices](https://go.dev/doc/)
